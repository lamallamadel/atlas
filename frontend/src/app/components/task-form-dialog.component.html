<div appFocusTrap role="dialog" aria-labelledby="dialog-title" aria-describedby="dialog-description" aria-modal="true">
  <h2 mat-dialog-title id="dialog-title">{{ isEditMode ? 'Edit Task' : 'Create New Task' }}</h2>
  <p id="dialog-description" class="sr-only">{{ isEditMode ? 'Edit task form' : 'Create new task form' }}. Fill in the fields below and submit.</p>

  <mat-dialog-content>
    <form [formGroup]="taskForm" class="task-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Title <span class="required" aria-label="required">*</span></mat-label>
        <input matInput formControlName="title" placeholder="Enter task title" maxlength="200" aria-required="true" [attr.aria-invalid]="titleError ? 'true' : 'false'">
        <mat-error *ngIf="titleError" role="alert">{{ titleError }}</mat-error>
      </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <textarea 
        matInput 
        formControlName="description" 
        placeholder="Enter task description"
        rows="4"
        maxlength="1000"
        aria-label="Task description"
        [attr.aria-invalid]="descriptionError ? 'true' : 'false'">
      </textarea>
      <mat-hint align="end">{{ taskForm.get('description')?.value?.length || 0 }} / 1000</mat-hint>
      <mat-error *ngIf="descriptionError" role="alert">{{ descriptionError }}</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Assigned To</mat-label>
      <mat-select formControlName="assignedTo" aria-label="Assign task to user">
        <mat-option [value]="''">Unassigned</mat-option>
        <mat-option *ngFor="let user of users" [value]="user.id">
          {{ user.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Due Date</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="dueDate" aria-label="Task due date">
      <mat-datepicker-toggle matSuffix [for]="picker" aria-label="Open calendar to select due date"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Priority</mat-label>
      <mat-select formControlName="priority" aria-label="Task priority level">
        <mat-option *ngFor="let priority of priorities" [value]="priority.value">
          {{ priority.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="loading" [attr.aria-label]="'Cancel task ' + (isEditMode ? 'editing' : 'creation')">Cancel</button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()"
      [disabled]="!taskForm.valid || loading"
      [attr.aria-busy]="loading"
      [attr.aria-label]="loading ? (isEditMode ? 'Updating task' : 'Creating task') : (isEditMode ? 'Update task' : 'Create task')">
      <mat-spinner *ngIf="loading" diameter="20" aria-hidden="true" style="display: inline-block; margin-right: 8px;"></mat-spinner>
      <span *ngIf="!loading">{{ isEditMode ? 'Update' : 'Create' }}</span>
      <span *ngIf="loading" class="sr-only" role="status" aria-live="polite">{{ isEditMode ? 'Updating task' : 'Creating task' }}</span>
    </button>
  </mat-dialog-actions>
</div>
