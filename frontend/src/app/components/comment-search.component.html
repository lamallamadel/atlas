<div class="comment-search-container">
  <div class="search-header">
    <h3>Search Comments</h3>
  </div>

  <form [formGroup]="searchForm" (ngSubmit)="search()" class="search-form">
    <mat-form-field appearance="outline" class="search-input">
      <mat-label>Search in comments</mat-label>
      <input matInput formControlName="query" placeholder="Enter search terms...">
      <button mat-icon-button matSuffix type="button" (click)="clearSearch()" 
              *ngIf="searchForm.value.query">
        <mat-icon>clear</mat-icon>
      </button>
    </mat-form-field>
    <button mat-raised-button color="primary" type="submit" [disabled]="!searchForm.value.query || searching">
      <mat-icon>search</mat-icon>
      Search
    </button>
  </form>

  <div *ngIf="searching" class="loading-state">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Searching...</p>
  </div>

  <div *ngIf="!searching && searchResults.length === 0 && searchForm.value.query" class="no-results">
    <mat-icon>search_off</mat-icon>
    <p>No comments found matching "{{ searchForm.value.query }}"</p>
  </div>

  <div *ngIf="searchResults.length > 0" class="search-results">
    <div class="results-header">
      <h4>Found {{ searchResults.length }} result(s)</h4>
    </div>

    <div *ngFor="let result of searchResults" class="result-item">
      <div class="result-header">
        <div class="result-meta">
          <mat-chip class="entity-chip">{{ result.entityType }}</mat-chip>
          <span class="entity-id">#{{ result.entityId }}</span>
          <span *ngIf="result.threadTitle" class="thread-title">{{ result.threadTitle }}</span>
        </div>
        <span class="result-date">{{ result.createdAt | date:'short' }}</span>
      </div>
      
      <div class="result-content" [innerHTML]="highlightQuery(result.content, searchForm.value.query)"></div>
      
      <div class="result-footer">
        <span class="result-author">
          <mat-icon>account_circle</mat-icon>
          {{ result.createdBy }}
        </span>
        <a [routerLink]="['/', result.entityType.toLowerCase(), result.entityId]" class="view-link">
          View Thread
          <mat-icon>arrow_forward</mat-icon>
        </a>
      </div>
    </div>
  </div>
</div>
