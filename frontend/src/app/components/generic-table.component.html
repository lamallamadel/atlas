<div class="table-container">
  <!-- Desktop Table View -->
  <div *ngIf="!isMobile" class="table-wrapper">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2" [class.sticky-header]="stickyHeader">
      
      <!-- Selection Column -->
      <ng-container matColumnDef="select" *ngIf="enableRowSelection">
        <th mat-header-cell *matHeaderCellDef class="selection-cell">
          <mat-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row" class="selection-cell">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? toggleRow(row) : null"
            [checked]="selection.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Data Columns -->
      <ng-container *ngFor="let column of columns" [matColumnDef]="column.key">
        <th mat-header-cell *matHeaderCellDef 
            [mat-sort-header]="column.sortable !== false && enableSort ? column.key : ''"
            [ngStyle]="getColumnStyle(column)"
            class="resizable-header">
          <div class="header-content">
            <span class="header-text">{{ column.header }}</span>
            <div *ngIf="column.resizable !== false" 
                 class="resize-handle" 
                 (mousedown)="onResizeStart($event, column.key)">
            </div>
          </div>
        </th>
        <td mat-cell *matCellDef="let row" [ngStyle]="getColumnStyle(column)">
          <span [innerHTML]="formatValue(row[column.key], column, row)"></span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions" *ngIf="showActions">
        <th mat-header-cell *matHeaderCellDef class="actions-header">Actions</th>
        <td mat-cell *matCellDef="let row" class="actions-cell">
          <button 
            *ngFor="let action of actions"
            [hidden]="!shouldShowAction(action, row)"
            mat-icon-button 
            [color]="action.color || 'primary'"
            [matTooltip]="action.tooltip"
            (click)="$event.stopPropagation(); onAction(action.action, row)">
            <mat-icon>{{ action.icon }}</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: stickyHeader"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
          [class.clickable-row]="rowClickable"
          [class.selected-row]="selection.isSelected(row)"
          (click)="onRowClick(row)"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell no-data" [attr.colspan]="displayedColumns.length">
          <div class="empty-state">
            <mat-icon class="empty-icon">inbox</mat-icon>
            <h3 class="empty-title">Aucune donnée disponible</h3>
            <p class="empty-message">Il n'y a actuellement aucune donnée à afficher</p>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <!-- Mobile Card View -->
  <div *ngIf="isMobile" class="card-container">
    <div *ngIf="data.length === 0" class="empty-state">
      <mat-icon class="empty-icon">inbox</mat-icon>
      <h3 class="empty-title">Aucune donnée disponible</h3>
      <p class="empty-message">Il n'y a actuellement aucune donnée à afficher</p>
    </div>

    <mat-card *ngFor="let row of dataSource.data" class="data-card" (click)="onRowClick(row)">
      <!-- Selection Checkbox -->
      <div *ngIf="enableRowSelection" class="card-selection">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="$event ? toggleRow(row) : null"
          [checked]="selection.isSelected(row)">
        </mat-checkbox>
      </div>

      <!-- Card Content -->
      <mat-card-content>
        <div *ngFor="let column of columns" class="card-field">
          <span class="field-label">{{ column.header }}:</span>
          <span class="field-value" [innerHTML]="formatValue(getRowValue(row, column.key), column, row)"></span>
        </div>
      </mat-card-content>

      <!-- Card Actions -->
      <mat-card-actions *ngIf="showActions" class="card-actions">
        <button 
          *ngFor="let action of actions"
          [hidden]="!shouldShowAction(action, row)"
          mat-icon-button 
          [color]="action.color || 'primary'"
          [matTooltip]="action.tooltip"
          (click)="$event.stopPropagation(); onAction(action.action, row)">
          <mat-icon>{{ action.icon }}</mat-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Paginator -->
  <mat-paginator 
    *ngIf="showPagination"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    showFirstLastButtons
    aria-label="Sélectionner la page">
  </mat-paginator>
</div>
