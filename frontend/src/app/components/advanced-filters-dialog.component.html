<div class="dialog-container">
  <h2 mat-dialog-title>Filtres avancés</h2>

  <mat-dialog-content class="dialog-content">
    <!-- Predefined Quick Filters -->
    <section class="quick-filters-section" *ngIf="predefinedPresets.length > 0">
      <h3 class="section-title">Filtres rapides</h3>
      <div class="quick-filters-grid">
        <button 
          *ngFor="let preset of predefinedPresets"
          mat-stroked-button
          class="quick-filter-btn"
          (click)="loadPreset(preset)">
          <div class="quick-filter-content">
            <mat-icon class="filter-icon">filter_alt</mat-icon>
            <div class="filter-info">
              <span class="filter-name">{{ preset.name }}</span>
              <span class="filter-desc" *ngIf="preset.description">{{ preset.description }}</span>
            </div>
          </div>
        </button>
      </div>
    </section>

    <!-- User Saved Presets -->
    <section class="saved-presets-section" *ngIf="userPresets.length > 0">
      <h3 class="section-title">Mes filtres sauvegardés</h3>
      <div class="saved-presets-list">
        <div *ngFor="let preset of userPresets" class="saved-preset-item">
          <button 
            mat-button
            class="preset-load-btn"
            (click)="loadPreset(preset)">
            <mat-icon>bookmark</mat-icon>
            <span>{{ preset.name }}</span>
          </button>
          <button 
            mat-icon-button
            color="warn"
            (click)="deletePreset(preset)"
            class="preset-delete-btn">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </section>

    <!-- Advanced Filters Component -->
    <section class="filters-section">
      <h3 class="section-title">Créer un filtre personnalisé</h3>
      <app-advanced-filters
        [fields]="data.fields"
        [initialFilter]="currentFilter"
        (filterChange)="onFilterChange($event)"
        (countRequest)="onCountRequest($event)"
        (filterApplied)="onFilterApplied($event)">
      </app-advanced-filters>
    </section>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="cancel()">Annuler</button>
    <button mat-raised-button color="accent" (click)="openSaveDialog()" [disabled]="!currentFilter">
      <mat-icon>save</mat-icon>
      Sauvegarder ce filtre
    </button>
  </mat-dialog-actions>
</div>

<!-- Save Preset Dialog -->
<div *ngIf="showSaveDialog" class="save-dialog-overlay" (click)="closeSaveDialog()">
  <div class="save-dialog-content" (click)="$event.stopPropagation()">
    <h3>Sauvegarder le filtre</h3>
    
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nom du filtre</mat-label>
      <input matInput [(ngModel)]="presetName" placeholder="Ex: Mes dossiers urgents">
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description (optionnel)</mat-label>
      <textarea matInput [(ngModel)]="presetDescription" rows="3"></textarea>
    </mat-form-field>

    <mat-checkbox [(ngModel)]="sharePreset">
      Partager avec mon équipe
    </mat-checkbox>

    <div class="save-dialog-actions">
      <button mat-button (click)="closeSaveDialog()">Annuler</button>
      <button mat-raised-button color="primary" (click)="savePreset()">
        <mat-icon>save</mat-icon>
        Sauvegarder
      </button>
    </div>
  </div>
</div>
