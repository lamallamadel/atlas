<div class="page-container">
  <div class="page-header">
    <h2 class="page-title">Tableau de bord</h2>
  </div>
  <div class="page-content">
    <div class="kpi-cards-container">
      <div class="kpi-card">
        <app-loading-skeleton *ngIf="loadingAnnonces" variant="dashboard-kpi"></app-loading-skeleton>
        <div *ngIf="!loadingAnnonces">
          <div class="kpi-card-header">
            <h3 class="kpi-card-title">Annonces actives</h3>
          </div>
          <div class="kpi-card-body">
            <div *ngIf="errorAnnonces" class="kpi-error">
              <span class="error-icon">✗</span>
              <span>{{errorAnnonces}}</span>
            </div>
            <div *ngIf="!errorAnnonces" class="kpi-value">
              {{annoncesActivesCount}}
            </div>
          </div>
          <div class="kpi-card-footer" *ngIf="!errorAnnonces">
            <button class="kpi-view-all-button" (click)="navigateToAnnoncesActives()">Voir tous</button>
          </div>
        </div>
      </div>

      <div class="kpi-card">
        <app-loading-skeleton *ngIf="loadingDossiers" variant="dashboard-kpi"></app-loading-skeleton>
        <div *ngIf="!loadingDossiers">
          <div class="kpi-card-header">
            <h3 class="kpi-card-title">Dossiers à traiter</h3>
          </div>
          <div class="kpi-card-body">
            <div *ngIf="errorDossiers" class="kpi-error">
              <span class="error-icon">✗</span>
              <span>{{errorDossiers}}</span>
            </div>
            <div *ngIf="!errorDossiers" class="kpi-value">
              {{dossiersATraiterCount}}
            </div>
          </div>
          <div class="kpi-card-footer" *ngIf="!errorDossiers">
            <button class="kpi-view-all-button" (click)="navigateToDossiersATraiter()">Voir tous</button>
          </div>
        </div>
      </div>

      <div class="kpi-card kpi-card-wide">
        <div class="kpi-card-header">
          <h3 class="kpi-card-title">Derniers dossiers</h3>
        </div>
        <div class="kpi-card-body">
          <app-loading-skeleton *ngIf="loadingRecent" variant="list" [rows]="5"></app-loading-skeleton>
          <div *ngIf="!loadingRecent && errorRecent" class="kpi-error">
            <span class="error-icon">✗</span>
            <span>{{errorRecent}}</span>
          </div>
          <div *ngIf="!loadingRecent && !errorRecent && recentDossiers.length === 0" class="kpi-empty">
            Aucun dossier
          </div>
          <div *ngIf="!loadingRecent && !errorRecent && recentDossiers.length > 0" class="dossiers-list">
            <div *ngFor="let dossier of recentDossiers" class="dossier-item">
              <div class="dossier-info">
                <div class="dossier-id">
                  <strong>ID:</strong> {{dossier.id}}
                </div>
                <div class="dossier-lead" *ngIf="dossier.leadName">
                  <strong>Lead:</strong> {{dossier.leadName}}
                </div>
                <div class="dossier-phone" *ngIf="dossier.leadPhone">
                  <strong>Téléphone:</strong> {{dossier.leadPhone}}
                </div>
                <div class="dossier-status">
                  <strong>Statut:</strong> {{dossier.status}}
                </div>
                <div class="dossier-date">
                  <strong>Créé le:</strong> {{dossier.createdAt | date:'short'}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="api-status-container">
      <h3>État de la connexion API</h3>
      <div class="status-card" [ngClass]="{
        'status-checking': apiStatus === 'checking',
        'status-connected': apiStatus === 'connected',
        'status-disconnected': apiStatus === 'disconnected'
      }">
        <div class="status-indicator">
          <span class="status-icon">{{apiStatus === 'connected' ? '✓' : apiStatus === 'disconnected' ? '✗' : '⟳'}}</span>
          <span class="status-text">
            {{apiStatus === 'connected' ? 'Connecté' : apiStatus === 'disconnected' ? 'Déconnecté' : 'Vérification...'}}
          </span>
        </div>
        <div class="status-details" *ngIf="lastChecked">
          <p>Dernière vérification : {{lastChecked | date:'short'}}</p>
        </div>
        <div class="status-error" *ngIf="errorMessage">
          <p class="error-message">{{errorMessage}}</p>
        </div>
        <button class="refresh-button" (click)="checkApiConnection()" [disabled]="apiStatus === 'checking'">
          Actualiser
        </button>
      </div>
    </div>
  </div>
</div>
