<div class="page-container">
  <div class="page-header">
    <h2 class="page-title">Créer un nouveau dossier</h2>
  </div>

  <div class="page-content">
    <div *ngIf="error" class="error-alert">
      <span class="error-icon">⚠</span>
      <span>{{ error }}</span>
    </div>

    <div *ngIf="duplicates.length > 0" class="warning-banner">
      <div class="warning-content">
        <span class="warning-icon">⚠</span>
        <div class="warning-text">
          <strong>Doublon trouvé !</strong>
          <p>Un dossier avec ce numéro de téléphone existe déjà.</p>
        </div>
      </div>
      <div class="warning-actions">
        <button
          *ngFor="let duplicate of duplicates"
          class="btn-open-existing"
          (click)="openExistingDossier(duplicate.id)"
          type="button"
        >
          Ouvrir l'existant (ID : {{ duplicate.id }})
        </button>
      </div>
    </div>

    <form [formGroup]="dossierForm" (ngSubmit)="onSubmit()" class="dossier-form">
      <div class="form-group">
        <label for="leadName" class="form-label">
          Nom du prospect
        </label>
        <input
          id="leadName"
          type="text"
          class="form-input"
          formControlName="leadName"
          [class.invalid]="isFieldInvalid('leadName')"
          placeholder="Saisir le nom du prospect"
        />
        <div *ngIf="getFieldError('leadName')" class="field-error">
          {{ getFieldError('leadName') }}
        </div>
      </div>

      <div class="form-group">
        <label for="leadPhone" class="form-label">
          Téléphone du prospect
        </label>
        <input
          id="leadPhone"
          type="text"
          class="form-input"
          formControlName="leadPhone"
          [class.invalid]="isFieldInvalid('leadPhone')"
          placeholder="Saisir le numéro de téléphone du prospect"
          (blur)="onPhoneBlur()"
        />
        <div *ngIf="checkingDuplicates" class="checking-duplicates">
          <span class="checking-spinner"></span>
          Vérification des doublons...
        </div>
        <div *ngIf="getFieldError('leadPhone')" class="field-error">
          {{ getFieldError('leadPhone') }}
        </div>
      </div>

      <div class="form-group">
        <label for="leadSource" class="form-label">
          Source du prospect
        </label>
        <input
          id="leadSource"
          type="text"
          class="form-input"
          formControlName="leadSource"
          [class.invalid]="isFieldInvalid('leadSource')"
          placeholder="Saisir la source du prospect"
        />
        <div *ngIf="getFieldError('leadSource')" class="field-error">
          {{ getFieldError('leadSource') }}
        </div>
      </div>

      <div class="form-group">
        <label for="annonceId" class="form-label">
          ID annonce
        </label>
        <input
          id="annonceId"
          type="number"
          class="form-input"
          formControlName="annonceId"
          [class.invalid]="isFieldInvalid('annonceId')"
          placeholder="Saisir l'ID de l'annonce (optionnel)"
        />
        <div *ngIf="getFieldError('annonceId')" class="field-error">
          {{ getFieldError('annonceId') }}
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="onCancel()">Annuler</button>
        <button type="submit" class="btn-submit" [disabled]="submitting">
          <span *ngIf="!submitting">Créer</span>
          <span *ngIf="submitting" class="btn-loading">
            <span class="btn-spinner"></span>
            Création...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
