spring:
  application:
    name: backend
  servlet:
    multipart:
      enabled: true
      max-file-size: ${MULTIPART_MAX_FILE_SIZE:10MB}
      max-request-size: ${MULTIPART_MAX_REQUEST_SIZE:10MB}
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${OAUTH2_ISSUER_URI:http://localhost:8081/realms/myrealm}

keycloak:
  admin:
    server-url: ${KEYCLOAK_ADMIN_SERVER_URL:http://localhost:8081}
    realm: ${KEYCLOAK_ADMIN_REALM:myrealm}
    client-id: ${KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}
    username: ${KEYCLOAK_ADMIN_USERNAME:admin}
    password: ${KEYCLOAK_ADMIN_PASSWORD:admin}
  mail:
    host: ${MAIL_HOST:localhost}
    port: ${MAIL_PORT:1025}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    from: ${MAIL_FROM:noreply@example.com}
    properties:
      mail:
        smtp:
          auth: ${MAIL_SMTP_AUTH:false}
          starttls:
            enable: ${MAIL_SMTP_STARTTLS:false}
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    mode: HTML
    encoding: UTF-8
    cache: false
  data:
    elasticsearch:
      repositories:
        enabled: ${ELASTICSEARCH_ENABLED:false}


  output:
    ansi:
      enabled: ALWAYS

# Optional: enable Spring Elasticsearch client only when desired
elasticsearch:
  enabled: ${ELASTICSEARCH_ENABLED:false}
  uris: ${ELASTICSEARCH_URIS:http://localhost:9200}
  username: ${ELASTICSEARCH_USERNAME:}
  password: ${ELASTICSEARCH_PASSWORD:}

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui

notification:
  processor:
    interval: ${NOTIFICATION_PROCESSOR_INTERVAL:10000}

rate-limit:
  default-requests-per-minute: ${RATE_LIMIT_DEFAULT_RPM:100}
  enabled: ${RATE_LIMIT_ENABLED:true}

outbound:
  worker:
    enabled: ${OUTBOUND_WORKER_ENABLED:true}
    poll-interval-ms: ${OUTBOUND_WORKER_POLL_INTERVAL_MS:5000}
    batch-size: ${OUTBOUND_WORKER_BATCH_SIZE:10}
  metrics:
    update-interval-ms: ${OUTBOUND_METRICS_UPDATE_INTERVAL_MS:10000}
  alert:
    enabled: ${OUTBOUND_ALERT_ENABLED:true}
    cron: ${OUTBOUND_ALERT_CRON:0 */15 * * * *}
    stuck-message-threshold-attempts: ${OUTBOUND_ALERT_STUCK_THRESHOLD_ATTEMPTS:3}
    stuck-message-age-hours: ${OUTBOUND_ALERT_STUCK_AGE_HOURS:2}
    max-results: ${OUTBOUND_ALERT_MAX_RESULTS:100}
    high-queue-depth:
      cron: ${OUTBOUND_ALERT_HIGH_QUEUE_CRON:0 */10 * * * *}
    dead-letter:
      cron: ${OUTBOUND_ALERT_DEAD_LETTER_CRON:0 0 * * * *}

whatsapp:
  cloud:
    api:
      base-url: ${WHATSAPP_CLOUD_API_BASE_URL:https://graph.facebook.com/v18.0}

storage:
  strategy: ${STORAGE_STRATEGY:localFileStorage}
  max-file-size: ${STORAGE_MAX_FILE_SIZE:10485760}
  local:
    base-path: ${STORAGE_LOCAL_BASE_PATH:./storage}
  s3:
    bucket-name: ${STORAGE_S3_BUCKET_NAME:}
    region: ${STORAGE_S3_REGION:us-east-1}
    access-key: ${STORAGE_S3_ACCESS_KEY:}
    secret-key: ${STORAGE_S3_SECRET_KEY:}

# App metadata (surfaced in /actuator/info when enabled)
app:
  env: ${APP_ENV:local}
  version: ${APP_VERSION:@project.version@}

atlas:
  slow-request:
    threshold-ms: ${ATLAS_SLOW_REQUEST_THRESHOLD_MS:1500}
  metrics:
    include-org-id: ${ATLAS_METRICS_INCLUDE_ORG_ID:false}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
    info:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    distribution:
      percentiles-histogram:
        http.server.requests: true
        outbound.message.delivery.latency: true
      percentiles:
        outbound.message.delivery.latency: 0.5, 0.75, 0.9, 0.95, 0.99
    tags:
      application: ${spring.application.name}
  info:
    build:
      enabled: true
    env:
      enabled: true
    java:
      enabled: true
    os:
      enabled: true

info:
  app:
    name: ${spring.application.name}
    description: Spring Boot Backend Application
    version: ${app.version}

resilience4j:
  circuitbreaker:
    instances:
      keycloak:
        failure-rate-threshold: ${RESILIENCE4J_KEYCLOAK_FAILURE_RATE_THRESHOLD:50}
        slow-call-rate-threshold: ${RESILIENCE4J_KEYCLOAK_SLOW_CALL_RATE_THRESHOLD:50}
        slow-call-duration-threshold: ${RESILIENCE4J_KEYCLOAK_SLOW_CALL_DURATION_THRESHOLD:2s}
        wait-duration-in-open-state: ${RESILIENCE4J_KEYCLOAK_WAIT_DURATION_OPEN:30s}
        permitted-number-of-calls-in-half-open-state: ${RESILIENCE4J_KEYCLOAK_PERMITTED_CALLS_HALF_OPEN:3}
        minimum-number-of-calls: ${RESILIENCE4J_KEYCLOAK_MIN_CALLS:5}
        sliding-window-size: ${RESILIENCE4J_KEYCLOAK_SLIDING_WINDOW_SIZE:10}
        sliding-window-type: COUNT_BASED
        register-health-indicator: true
